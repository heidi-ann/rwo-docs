<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Service_command.html">
<link rel="next" href="Shell__core.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Alternating_primary_backup_assignment" rel="Chapter" href="Alternating_primary_backup_assignment.html">
<link title="Atomic_edit" rel="Chapter" href="Atomic_edit.html">
<link title="Bin_io_utils" rel="Chapter" href="Bin_io_utils.html">
<link title="Bitarray" rel="Chapter" href="Bitarray.html">
<link title="Cache" rel="Chapter" href="Cache.html">
<link title="Cbuffer" rel="Chapter" href="Cbuffer.html">
<link title="Color_print" rel="Chapter" href="Color_print.html">
<link title="Crit_bit" rel="Chapter" href="Crit_bit.html">
<link title="Csv_writer" rel="Chapter" href="Csv_writer.html">
<link title="Deprecated_bench" rel="Chapter" href="Deprecated_bench.html">
<link title="Deprecated_command" rel="Chapter" href="Deprecated_command.html">
<link title="Deprecated_fcommand" rel="Chapter" href="Deprecated_fcommand.html">
<link title="Deprecated_service_command" rel="Chapter" href="Deprecated_service_command.html">
<link title="Documented_match_statement" rel="Chapter" href="Documented_match_statement.html">
<link title="English" rel="Chapter" href="English.html">
<link title="Environment" rel="Chapter" href="Environment.html">
<link title="Exception_check" rel="Chapter" href="Exception_check.html">
<link title="Extended_array" rel="Chapter" href="Extended_array.html">
<link title="Extended_common" rel="Chapter" href="Extended_common.html">
<link title="Extended_exn" rel="Chapter" href="Extended_exn.html">
<link title="Extended_filename" rel="Chapter" href="Extended_filename.html">
<link title="Extended_float" rel="Chapter" href="Extended_float.html">
<link title="Extended_gc" rel="Chapter" href="Extended_gc.html">
<link title="Extended_hashtbl" rel="Chapter" href="Extended_hashtbl.html">
<link title="Extended_int" rel="Chapter" href="Extended_int.html">
<link title="Extended_int32" rel="Chapter" href="Extended_int32.html">
<link title="Extended_int63" rel="Chapter" href="Extended_int63.html">
<link title="Extended_int64" rel="Chapter" href="Extended_int64.html">
<link title="Extended_linux" rel="Chapter" href="Extended_linux.html">
<link title="Extended_list" rel="Chapter" href="Extended_list.html">
<link title="Extended_list__LCS" rel="Chapter" href="Extended_list__LCS.html">
<link title="Extended_list__multimerge" rel="Chapter" href="Extended_list__multimerge.html">
<link title="Extended_memo" rel="Chapter" href="Extended_memo.html">
<link title="Extended_monad" rel="Chapter" href="Extended_monad.html">
<link title="Extended_nativeint" rel="Chapter" href="Extended_nativeint.html">
<link title="Extended_option" rel="Chapter" href="Extended_option.html">
<link title="Extended_result" rel="Chapter" href="Extended_result.html">
<link title="Extended_sexp" rel="Chapter" href="Extended_sexp.html">
<link title="Extended_string" rel="Chapter" href="Extended_string.html">
<link title="Extended_sys" rel="Chapter" href="Extended_sys.html">
<link title="Extended_thread" rel="Chapter" href="Extended_thread.html">
<link title="Extended_time" rel="Chapter" href="Extended_time.html">
<link title="Extended_unix" rel="Chapter" href="Extended_unix.html">
<link title="Extra_fields" rel="Chapter" href="Extra_fields.html">
<link title="Fd_leak_check" rel="Chapter" href="Fd_leak_check.html">
<link title="Find" rel="Chapter" href="Find.html">
<link title="Fold_map" rel="Chapter" href="Fold_map.html">
<link title="Generic" rel="Chapter" href="Generic.html">
<link title="Invariant" rel="Chapter" href="Invariant.html">
<link title="Invocation" rel="Chapter" href="Invocation.html">
<link title="Iter" rel="Chapter" href="Iter.html">
<link title="Lazy_list" rel="Chapter" href="Lazy_list.html">
<link title="Lazy_m" rel="Chapter" href="Lazy_m.html">
<link title="Lazy_sequence" rel="Chapter" href="Lazy_sequence.html">
<link title="Linebuf" rel="Chapter" href="Linebuf.html">
<link title="List_zipper" rel="Chapter" href="List_zipper.html">
<link title="Logger" rel="Chapter" href="Logger.html">
<link title="Loggers" rel="Chapter" href="Loggers.html">
<link title="Low_level_debug" rel="Chapter" href="Low_level_debug.html">
<link title="Malloc" rel="Chapter" href="Malloc.html">
<link title="Multi_map" rel="Chapter" href="Multi_map.html">
<link title="Net_utils" rel="Chapter" href="Net_utils.html">
<link title="Number" rel="Chapter" href="Number.html">
<link title="Packed_array" rel="Chapter" href="Packed_array.html">
<link title="Packed_map" rel="Chapter" href="Packed_map.html">
<link title="Patience_diff" rel="Chapter" href="Patience_diff.html">
<link title="Posix_clock" rel="Chapter" href="Posix_clock.html">
<link title="Pp" rel="Chapter" href="Pp.html">
<link title="Printc" rel="Chapter" href="Printc.html">
<link title="Process" rel="Chapter" href="Process.html">
<link title="Procfs" rel="Chapter" href="Procfs.html">
<link title="Prod_or_test" rel="Chapter" href="Prod_or_test.html">
<link title="Random_selection" rel="Chapter" href="Random_selection.html">
<link title="Readline" rel="Chapter" href="Readline.html">
<link title="Readline__input_char" rel="Chapter" href="Readline__input_char.html">
<link title="Readline__input_loop" rel="Chapter" href="Readline__input_loop.html">
<link title="Runtime_blockout_detector" rel="Chapter" href="Runtime_blockout_detector.html">
<link title="Rw_mutex" rel="Chapter" href="Rw_mutex.html">
<link title="Sampler" rel="Chapter" href="Sampler.html">
<link title="Search_foo" rel="Chapter" href="Search_foo.html">
<link title="Selector" rel="Chapter" href="Selector.html">
<link title="Semaphore" rel="Chapter" href="Semaphore.html">
<link title="Sendmail" rel="Chapter" href="Sendmail.html">
<link title="Service_command" rel="Chapter" href="Service_command.html">
<link title="Shell" rel="Chapter" href="Shell.html">
<link title="Shell__core" rel="Chapter" href="Shell__core.html">
<link title="Shell__line_buffer" rel="Chapter" href="Shell__line_buffer.html">
<link title="Sntp" rel="Chapter" href="Sntp.html">
<link title="Splay_tree" rel="Chapter" href="Splay_tree.html">
<link title="Stats_reporting" rel="Chapter" href="Stats_reporting.html">
<link title="Std" rel="Chapter" href="Std.html">
<link title="String_zipper" rel="Chapter" href="String_zipper.html">
<link title="Syslog" rel="Chapter" href="Syslog.html">
<link title="Sys_utils" rel="Chapter" href="Sys_utils.html">
<link title="Tcp" rel="Chapter" href="Tcp.html">
<link title="Text_block" rel="Chapter" href="Text_block.html">
<link title="Time_stamp_counter" rel="Chapter" href="Time_stamp_counter.html">
<link title="Timed_function" rel="Chapter" href="Timed_function.html">
<link title="Trie" rel="Chapter" href="Trie.html">
<link title="Unix_utils" rel="Chapter" href="Unix_utils.html">
<link title="Update_queue" rel="Chapter" href="Update_queue.html"><link title="Process handling " rel="Section" href="#6_Processhandling">
<link title="Small helper commands" rel="Section" href="#6_Smallhelpercommands">
<link title="Basic run functions" rel="Subsection" href="#9_Basicrunfunctions">
<link title="Dispatch to /bin/bash" rel="Subsection" href="#9_Dispatchtobinbash">
<link title="Test dispatches" rel="Subsection" href="#9_Testdispatches">
<title>Shell</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Service_command.html" title="Service_command">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Shell__core.html" title="Shell__core">Next</a>
</div>
<h1>Module <a href="type_Shell.html">Shell</a></h1>
<pre><span class="keyword">module</span> Shell: <code class="code">sig</code> <a href="Shell.html">..</a> <code class="code">end</code></pre><div class="info">
Shell scripting in OCaml.
<p>

    This module contains basic blocks for shell scripting in OCaml. It tends to
    be safer than just using <code class="code">Unix.system</code> because it handles errors more
    strictly.<br>
</div>
<hr width="100%">
<br>
<h6 id="6_Processhandling">Process handling </h6><br>
<pre><span id="TYPEwith_process_flags"><span class="keyword">type</span> <code class="type">'a</code> with_process_flags</span> = <code class="type">?use_extra_path:bool -><br>       ?timeout:<a href="../core/Time.Span.html">Core.Std.Time.Span</a>.t option -><br>       ?working_dir:string -><br>       ?setuid:int -><br>       ?setgid:int -><br>       ?env:[ `Extend of (string * string) list | `Replace of (string * string) list ] -><br>       ?verbose:bool -><br>       ?echo:bool -> ?input:string -> ?keep_open:bool -> ?tail_len:int -> 'a</code> </pre>
<div class="info">
This type is an umbrella type for all the command that dispatch a process.
   It comes with a list of arguments whose default value can be tweaked by
   set_defaults.
<p>
<ul>
<li><code class="code">use_extra_path</code> : if we fail to find the command in the path then
   we look for it <code class="code">extra_path</code></li>
<li><code class="code">timeout</code> : the command will raise <code class="code">Failed</code> if the program doesn't
     do any IO for this period of time</li>
<li><code class="code">working_dir</code> : run the command in this directory</li>
<li><code class="code">verbose</code> : prints the output of the command</li>
<li><code class="code">echo</code> : print out the command before running it</li>
<li><code class="code">input</code> : a string to pipe through the program's standard in</li>
<li><code class="code">export</code> : a list of variable to export in the environement of the
   dispatched programm</li>
</ul>
<br>
</div>

<pre><span id="TYPEwith_run_flags"><span class="keyword">type</span> <code class="type">'a</code> with_run_flags</span> = <code class="type">?expect:int list -> 'a <a href="Shell.html#TYPEwith_process_flags">with_process_flags</a></code> </pre>
<div class="info">
This is the list of flags for normal process dispatch. It is an extension of
   <code class="code">with_process_flags</code>.
<p>
<ul>
<li><code class="code">expect</code> : an int list of valid return codes. default value is <code class="code">[0]</code>, if
   the return code of the dispatched is not in this list we will blowup with
   <code class="code">Process.Failure</code></li>
</ul>
<br>
</div>

<br>
<div class="h9" id="9_Basicrunfunctions">Basic run functions</div>
<p>

    In all the functions below the command is specified with two arguments.  The
    first one is a string representing the process to run.  The second one is
    the list of arguments to pass.
<p>

    Although the arguments do not need to be escaped there is still a risk that
    they might be interpreted as flags when they aren't. Most basic unix
    utilities provide the ability to pass arguments after "--" to avoid this.
<p>

    Usage example:
    <pre class="codepre"><code class="code">    let patch = run_full ~expect:[0;1] "diff" ["-u";"--";file1;file2]
    </code></pre><br>
<pre><span id="TYPEcmd"><span class="keyword">type</span> <code class="type">'a</code> cmd</span> = <code class="type">string -> string list -> 'a</code> </pre>

<pre><span id="VALrun"><span class="keyword">val</span> run</span> : <code class="type">unit <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><div class="info">
Runs a command and discards its output.<br>
</div>
<pre><span id="VALrun_lines"><span class="keyword">val</span> run_lines</span> : <code class="type">?eol:char -> string list <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><div class="info">
Runs a command and returns its output line separated. Note: most commands
    print a newline at the end of their output so the shell prompt appears on
    its own line. If the output ends in a newline, it is stripped before
    splitting the output into a string list to avoid there being a final
    element in the list containing just the empty string.
<p>

    In some cases, the newline should not be stripped (e.g., "cat" will not
    "add" a newline). If you care, use <code class="code">run_full</code> for the entire buffer.<br>
</div>
<pre><span id="VALrun_one"><span class="keyword">val</span> run_one</span> : <code class="type">?eol:char -> string option <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><div class="info">
Returns the first line of the command's output.
    (This function might terminate the program early the same way that
    piping through grep would)<br>
</div>
<pre><span id="VALrun_one_exn"><span class="keyword">val</span> run_one_exn</span> : <code class="type">?eol:char -> string <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALrun_full"><span class="keyword">val</span> run_full</span> : <code class="type">string <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><div class="info">
Return the full command's output in one string. See the note in
    <code class="code">run_lines</code>.<br>
</div>
<pre><span id="VALrun_fold"><span class="keyword">val</span> run_fold</span> : <code class="type">?eol:char -><br>       init:'a -><br>       f:('a -> string -> 'a * [ `Continue | `Stop ]) -><br>       'a <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><div class="info">
Fold over the lines in the stdout of a process;
    The `Continue/`Stop argument is there to allow early returning.
    <code class="code">eol</code> specifies the end of line character used to separate the lines
    outputted by the the program<br>
</div>
<br>
<div class="h9" id="9_Dispatchtobinbash">Dispatch to /bin/bash</div>
<p>

    All these function take a format (like printf) and run it through the shell.
<p>

    Usage example:
<pre class="codepre"><code class="code">    sh "cp -- %s %s" (Filename.quote file1)  (Filename.quote file2)
</code></pre>
<p>

    In general it is recommended to avoid using those too much and to prefer the
    run* family of function instead because it avoids pitfall like escaping
    issues and is much more straightforward to think about.<br>
<pre><span id="TYPEsh_cmd"><span class="keyword">type</span> <code class="type">('a, 'ret)</code> sh_cmd</span> = <code class="type">('a, unit, string, 'ret) Pervasives.format4 -> 'a</code> </pre>

<pre><span id="VALsh"><span class="keyword">val</span> sh</span> : <code class="type">('a, unit) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALsh_lines"><span class="keyword">val</span> sh_lines</span> : <code class="type">('a, string list) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALsh_full"><span class="keyword">val</span> sh_full</span> : <code class="type">('a, string) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALsh_one"><span class="keyword">val</span> sh_one</span> : <code class="type">('a, string option) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALsh_one_exn"><span class="keyword">val</span> sh_one_exn</span> : <code class="type">('a, string) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a></code></pre><pre><span id="VALnoninteractive_ssh_options"><span class="keyword">val</span> noninteractive_ssh_options</span> : <code class="type">string list</code></pre><pre><span id="VALnoninteractive_no_hostkey_checking_options"><span class="keyword">val</span> noninteractive_no_hostkey_checking_options</span> : <code class="type">string list</code></pre><pre><span id="TYPEwith_ssh_flags"><span class="keyword">type</span> <code class="type">'a</code> with_ssh_flags</span> = <code class="type">?ssh_options:string list -> ?user:string -> host:string -> 'a</code> </pre>

<pre><span id="VALssh"><span class="keyword">val</span> ssh</span> : <code class="type">('a, unit) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><pre><span id="VALssh_lines"><span class="keyword">val</span> ssh_lines</span> : <code class="type">('a, string list) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><pre><span id="VALssh_full"><span class="keyword">val</span> ssh_full</span> : <code class="type">('a, string) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><pre><span id="VALssh_one"><span class="keyword">val</span> ssh_one</span> : <code class="type">('a, string option) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><pre><span id="VALssh_one_exn"><span class="keyword">val</span> ssh_one_exn</span> : <code class="type">('a, string) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_run_flags">with_run_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><br>
<div class="h9" id="9_Testdispatches">Test dispatches</div>
<p>

    Usage example:
<pre class="codepre"><code class="code">    if Shell.test "diff" ["-q";"--";file1;file2] then
       Printf.printf "Files %S and %S are the same\n%!" file1 file2;
</code></pre><br>
<pre><span id="TYPEwith_test_flags"><span class="keyword">type</span> <code class="type">'a</code> with_test_flags</span> = <code class="type">?true_v:int list -> ?false_v:int list -> 'a <a href="Shell.html#TYPEwith_process_flags">with_process_flags</a></code> </pre>
<div class="info">
This is the list of flags for dispatching processes in test mode. This is
    used to test the return code of the dispatched program. The return value of
    these functions will be :<ul>
<li><code class="code">true</code> if the exit code is in <code class="code">true_v</code>.</li>
<li><code class="code">false</code> if the exit code is in <code class="code">false_v</code> and not in <code class="code">true_v</code>.</li>
<li>Raises <code class="code">Process.Failure</code> otherwise</li>
</ul>

    The default values are:<ul>
<li><code class="code">true_v</code>: default value <code class="code">[0]</code></li>
<li><code class="code">false_v</code>: default_value <code class="code">[1]</code></li>
</ul>
<br>
</div>

<pre><span id="VALtest"><span class="keyword">val</span> test</span> : <code class="type">bool <a href="Shell.html#TYPEcmd">cmd</a> <a href="Shell.html#TYPEwith_test_flags">with_test_flags</a></code></pre><pre><span id="VALsh_test"><span class="keyword">val</span> sh_test</span> : <code class="type">('a, bool) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_test_flags">with_test_flags</a></code></pre><pre><span id="VALssh_test"><span class="keyword">val</span> ssh_test</span> : <code class="type">('a, bool) <a href="Shell.html#TYPEsh_cmd">sh_cmd</a> <a href="Shell.html#TYPEwith_test_flags">with_test_flags</a> <a href="Shell.html#TYPEwith_ssh_flags">with_ssh_flags</a></code></pre><pre><span id="VALextra_path"><span class="keyword">val</span> extra_path</span> : <code class="type">string list Pervasives.ref</code></pre><div class="info">
variable used by dispatch command to find binaries not in the path.
    The default values contains only directory which should be in PATH and is
    only useful in environments where the PATH variable has been blown away.<br>
</div>
<pre><span class="keyword">module</span> <a href="Shell.Process.html">Process</a>: <code class="code">sig</code> <a href="Shell.Process.html">..</a> <code class="code">end</code></pre><div class="info">
Process dispatching
</div>
<br>
<h6 id="6_Smallhelpercommands">Small helper commands</h6><br>
<pre><span id="VALmkdir"><span class="keyword">val</span> mkdir</span> : <code class="type">?p:unit -> ?perm:int -> string -> unit</code></pre><pre><span id="VALcp"><span class="keyword">val</span> cp</span> : <code class="type">?overwrite:bool -> ?perm:<a href="../core/Unix.html">Core.Std.Unix</a>.file_perm -> string -> string -> unit</code></pre><pre><span id="VALln"><span class="keyword">val</span> ln</span> : <code class="type">?s:unit -> ?f:unit -> string -> string -> unit</code></pre><pre><span id="VALrm"><span class="keyword">val</span> rm</span> : <code class="type">?r:unit -> ?f:unit -> string -> unit</code></pre><pre><span id="VALmv"><span class="keyword">val</span> mv</span> : <code class="type">string -> string -> unit</code></pre><div class="info">
Raises "Failed_command"<br>
</div>
<pre><span id="VALwhoami"><span class="keyword">val</span> whoami</span> : <code class="type">?real:bool -> unit -> string</code></pre><div class="info">
Get the username. By default, the effective username. If real is true, get
    the real username.<br>
</div>
<pre><span id="VALwhich"><span class="keyword">val</span> which</span> : <code class="type">?use_extra_path:bool -> string -> string option</code></pre><pre><span id="VALscp"><span class="keyword">val</span> scp</span> : <code class="type">?compress:bool -><br>       ?recurse:bool -> ?user:string -> host:string -> string -> string -> unit</code></pre><div class="info">
<code class="code">scp user host from to</code> copy local file from to to<br>
</div>
</body></html>