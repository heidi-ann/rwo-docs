<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Time_internal.html">
<link rel="next" href="Timing_wheel.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Array_permute" rel="Chapter" href="Array_permute.html">
<link title="Avltree" rel="Chapter" href="Avltree.html">
<link title="Backtrace" rel="Chapter" href="Backtrace.html">
<link title="Bag" rel="Chapter" href="Bag.html">
<link title="Bigbuffer" rel="Chapter" href="Bigbuffer.html">
<link title="Bigbuffer_internal" rel="Chapter" href="Bigbuffer_internal.html">
<link title="Bigstring" rel="Chapter" href="Bigstring.html">
<link title="Bigstring_marshal" rel="Chapter" href="Bigstring_marshal.html">
<link title="Bigsubstring" rel="Chapter" href="Bigsubstring.html">
<link title="Binable" rel="Chapter" href="Binable.html">
<link title="Binable0" rel="Chapter" href="Binable0.html">
<link title="Binary_packing" rel="Chapter" href="Binary_packing.html">
<link title="Blang" rel="Chapter" href="Blang.html">
<link title="Bool" rel="Chapter" href="Bool.html">
<link title="Bounded_int_table" rel="Chapter" href="Bounded_int_table.html">
<link title="Bucket" rel="Chapter" href="Bucket.html">
<link title="Byte_units" rel="Chapter" href="Byte_units.html">
<link title="Caml" rel="Chapter" href="Caml.html">
<link title="Command" rel="Chapter" href="Command.html">
<link title="Common" rel="Chapter" href="Common.html">
<link title="Commutative_group" rel="Chapter" href="Commutative_group.html">
<link title="Comparable" rel="Chapter" href="Comparable.html">
<link title="Comparable_intf" rel="Chapter" href="Comparable_intf.html">
<link title="Comparator" rel="Chapter" href="Comparator.html">
<link title="Constrained_float" rel="Chapter" href="Constrained_float.html">
<link title="Container" rel="Chapter" href="Container.html">
<link title="Core_arg" rel="Chapter" href="Core_arg.html">
<link title="Core_array" rel="Chapter" href="Core_array.html">
<link title="Core_bin_prot" rel="Chapter" href="Core_bin_prot.html">
<link title="Core_char" rel="Chapter" href="Core_char.html">
<link title="Core_condition" rel="Chapter" href="Core_condition.html">
<link title="Core_field" rel="Chapter" href="Core_field.html">
<link title="Core_filename" rel="Chapter" href="Core_filename.html">
<link title="Core_gc" rel="Chapter" href="Core_gc.html">
<link title="Core_hashtbl" rel="Chapter" href="Core_hashtbl.html">
<link title="Core_hashtbl_intf" rel="Chapter" href="Core_hashtbl_intf.html">
<link title="Core_int" rel="Chapter" href="Core_int.html">
<link title="Core_int32" rel="Chapter" href="Core_int32.html">
<link title="Core_int63" rel="Chapter" href="Core_int63.html">
<link title="Core_int64" rel="Chapter" href="Core_int64.html">
<link title="Core_lazy" rel="Chapter" href="Core_lazy.html">
<link title="Core_list" rel="Chapter" href="Core_list.html">
<link title="Core_map" rel="Chapter" href="Core_map.html">
<link title="Core_map_intf" rel="Chapter" href="Core_map_intf.html">
<link title="Core_map_unit_tests" rel="Chapter" href="Core_map_unit_tests.html">
<link title="Core_mutex" rel="Chapter" href="Core_mutex.html">
<link title="Core_nativeint" rel="Chapter" href="Core_nativeint.html">
<link title="Core_printexc" rel="Chapter" href="Core_printexc.html">
<link title="Core_printf" rel="Chapter" href="Core_printf.html">
<link title="Core_queue" rel="Chapter" href="Core_queue.html">
<link title="Core_random" rel="Chapter" href="Core_random.html">
<link title="Core_set" rel="Chapter" href="Core_set.html">
<link title="Core_set_intf" rel="Chapter" href="Core_set_intf.html">
<link title="Core_set_unit_tests" rel="Chapter" href="Core_set_unit_tests.html">
<link title="Core_sexp" rel="Chapter" href="Core_sexp.html">
<link title="Core_stack" rel="Chapter" href="Core_stack.html">
<link title="Core_string" rel="Chapter" href="Core_string.html">
<link title="Core_sys" rel="Chapter" href="Core_sys.html">
<link title="Core_thread" rel="Chapter" href="Core_thread.html">
<link title="Core_unix" rel="Chapter" href="Core_unix.html">
<link title="Core_weak" rel="Chapter" href="Core_weak.html">
<link title="Crc" rel="Chapter" href="Crc.html">
<link title="Daemon" rel="Chapter" href="Daemon.html">
<link title="Date" rel="Chapter" href="Date.html">
<link title="Day_of_week" rel="Chapter" href="Day_of_week.html">
<link title="Dequeue" rel="Chapter" href="Dequeue.html">
<link title="Doubly_linked" rel="Chapter" href="Doubly_linked.html">
<link title="Equal" rel="Chapter" href="Equal.html">
<link title="Error" rel="Chapter" href="Error.html">
<link title="Exn" rel="Chapter" href="Exn.html">
<link title="Flags" rel="Chapter" href="Flags.html">
<link title="Flags_intf" rel="Chapter" href="Flags_intf.html">
<link title="Float" rel="Chapter" href="Float.html">
<link title="Floatable" rel="Chapter" href="Floatable.html">
<link title="Float_intf" rel="Chapter" href="Float_intf.html">
<link title="Float_robust_compare" rel="Chapter" href="Float_robust_compare.html">
<link title="Fn" rel="Chapter" href="Fn.html">
<link title="Force_once" rel="Chapter" href="Force_once.html">
<link title="Fqueue" rel="Chapter" href="Fqueue.html">
<link title="Hashable" rel="Chapter" href="Hashable.html">
<link title="Hash_heap" rel="Chapter" href="Hash_heap.html">
<link title="Hash_queue" rel="Chapter" href="Hash_queue.html">
<link title="Hash_set" rel="Chapter" href="Hash_set.html">
<link title="Hash_set_intf" rel="Chapter" href="Hash_set_intf.html">
<link title="Heap" rel="Chapter" href="Heap.html">
<link title="Heap_block" rel="Chapter" href="Heap_block.html">
<link title="Host_and_port" rel="Chapter" href="Host_and_port.html">
<link title="Identifiable" rel="Chapter" href="Identifiable.html">
<link title="In_channel" rel="Chapter" href="In_channel.html">
<link title="Info" rel="Chapter" href="Info.html">
<link title="Intable" rel="Chapter" href="Intable.html">
<link title="Int_conversions" rel="Chapter" href="Int_conversions.html">
<link title="Interfaces" rel="Chapter" href="Interfaces.html">
<link title="Interned_string" rel="Chapter" href="Interned_string.html">
<link title="Interval" rel="Chapter" href="Interval.html">
<link title="Interval_intf" rel="Chapter" href="Interval_intf.html">
<link title="Int_intf" rel="Chapter" href="Int_intf.html">
<link title="Int_math" rel="Chapter" href="Int_math.html">
<link title="Int_replace_polymorphic_compare" rel="Chapter" href="Int_replace_polymorphic_compare.html">
<link title="Int_set" rel="Chapter" href="Int_set.html">
<link title="Invariant" rel="Chapter" href="Invariant.html">
<link title="Iobuf" rel="Chapter" href="Iobuf.html">
<link title="Iobuf_debug" rel="Chapter" href="Iobuf_debug.html">
<link title="Iobuf_intf" rel="Chapter" href="Iobuf_intf.html">
<link title="Iobuf_tests" rel="Chapter" href="Iobuf_tests.html">
<link title="Linux_ext" rel="Chapter" href="Linux_ext.html">
<link title="Lock_file" rel="Chapter" href="Lock_file.html">
<link title="Make_substring" rel="Chapter" href="Make_substring.html">
<link title="Memo" rel="Chapter" href="Memo.html">
<link title="Monad" rel="Chapter" href="Monad.html">
<link title="Month" rel="Chapter" href="Month.html">
<link title="Mutex0" rel="Chapter" href="Mutex0.html">
<link title="Nano_mutex" rel="Chapter" href="Nano_mutex.html">
<link title="Never_returns" rel="Chapter" href="Never_returns.html">
<link title="No_polymorphic_compare" rel="Chapter" href="No_polymorphic_compare.html">
<link title="Nothing" rel="Chapter" href="Nothing.html">
<link title="Nothing0" rel="Chapter" href="Nothing0.html">
<link title="Ofday" rel="Chapter" href="Ofday.html">
<link title="Only_in_test" rel="Chapter" href="Only_in_test.html">
<link title="Option" rel="Chapter" href="Option.html">
<link title="Ordered_collection_common" rel="Chapter" href="Ordered_collection_common.html">
<link title="Ordering" rel="Chapter" href="Ordering.html">
<link title="Or_error" rel="Chapter" href="Or_error.html">
<link title="Out_channel" rel="Chapter" href="Out_channel.html">
<link title="Pid" rel="Chapter" href="Pid.html">
<link title="Piecewise_linear" rel="Chapter" href="Piecewise_linear.html">
<link title="Piecewise_linear_intf" rel="Chapter" href="Piecewise_linear_intf.html">
<link title="Polymorphic_compare" rel="Chapter" href="Polymorphic_compare.html">
<link title="Polymorphic_compare_intf" rel="Chapter" href="Polymorphic_compare_intf.html">
<link title="Pretty_printer" rel="Chapter" href="Pretty_printer.html">
<link title="Process_env" rel="Chapter" href="Process_env.html">
<link title="Quickcheck" rel="Chapter" href="Quickcheck.html">
<link title="Ref" rel="Chapter" href="Ref.html">
<link title="Result" rel="Chapter" href="Result.html">
<link title="Robustly_comparable" rel="Chapter" href="Robustly_comparable.html">
<link title="Set_once" rel="Chapter" href="Set_once.html">
<link title="Sexpable" rel="Chapter" href="Sexpable.html">
<link title="Signal" rel="Chapter" href="Signal.html">
<link title="Source_code_position" rel="Chapter" href="Source_code_position.html">
<link title="Source_code_position0" rel="Chapter" href="Source_code_position0.html">
<link title="Span" rel="Chapter" href="Span.html">
<link title="Squeue" rel="Chapter" href="Squeue.html">
<link title="Stable" rel="Chapter" href="Stable.html">
<link title="Stable_containers" rel="Chapter" href="Stable_containers.html">
<link title="Stable_internal" rel="Chapter" href="Stable_internal.html">
<link title="Stable_unit_test" rel="Chapter" href="Stable_unit_test.html">
<link title="Stable_unit_test_intf" rel="Chapter" href="Stable_unit_test_intf.html">
<link title="Staged" rel="Chapter" href="Staged.html">
<link title="Std" rel="Chapter" href="Std.html">
<link title="Std_common" rel="Chapter" href="Std_common.html">
<link title="Std_kernel" rel="Chapter" href="Std_kernel.html">
<link title="Std_internal" rel="Chapter" href="Std_internal.html">
<link title="Stringable" rel="Chapter" href="Stringable.html">
<link title="String_id" rel="Chapter" href="String_id.html">
<link title="Substring" rel="Chapter" href="Substring.html">
<link title="Substring_intf" rel="Chapter" href="Substring_intf.html">
<link title="T" rel="Chapter" href="T.html">
<link title="Thread_safe_queue" rel="Chapter" href="Thread_safe_queue.html">
<link title="Time" rel="Chapter" href="Time.html">
<link title="Time_internal" rel="Chapter" href="Time_internal.html">
<link title="Timer" rel="Chapter" href="Timer.html">
<link title="Timing_wheel" rel="Chapter" href="Timing_wheel.html">
<link title="Timing_wheel_intf" rel="Chapter" href="Timing_wheel_intf.html">
<link title="Timing_wheel_unit_tests" rel="Chapter" href="Timing_wheel_unit_tests.html">
<link title="Tuple" rel="Chapter" href="Tuple.html">
<link title="Type_equal" rel="Chapter" href="Type_equal.html">
<link title="Union_find" rel="Chapter" href="Union_find.html">
<link title="Unique_id" rel="Chapter" href="Unique_id.html">
<link title="Unique_id_intf" rel="Chapter" href="Unique_id_intf.html">
<link title="Unit" rel="Chapter" href="Unit.html">
<link title="Univ" rel="Chapter" href="Univ.html">
<link title="Univ_map" rel="Chapter" href="Univ_map.html">
<link title="Unpack_buffer" rel="Chapter" href="Unpack_buffer.html">
<link title="User_and_group" rel="Chapter" href="User_and_group.html">
<link title="Uuid" rel="Chapter" href="Uuid.html">
<link title="Validate" rel="Chapter" href="Validate.html">
<link title="With_return" rel="Chapter" href="With_return.html">
<link title="Word_size" rel="Chapter" href="Word_size.html">
<link title="Zone" rel="Chapter" href="Zone.html"><title>Timer</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Time_internal.html" title="Time_internal">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Timing_wheel.html" title="Timing_wheel">Next</a>
</div>
<h1>Module <a href="type_Timer.html">Timer</a></h1>
<pre><span class="keyword">module</span> Timer: <code class="code">sig</code> <a href="Timer.html">..</a> <code class="code">end</code></pre><div class="info">
Timed events
<p>

    This implementation uses a priority queue (heap) for efficient
    adding of timed events.  A timer thread wakes up whenever an event
    is supposed to be run or when the set of watched events changes.
    The timer can handle more than a million scheduled events.
    Timed events can also be efficiently removed (in O(log(n))).
<p>

    This interface is thread-safe.<br>
</div>
<hr width="100%">
<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info">
Type of timers<br>
</div>

<pre><span id="TYPEevent"><span class="keyword">type</span> <code class="type"></code>event</span> </pre>
<div class="info">
Type of events.  Returned when adding event handlers to the timer, and
    needed for removing them again.<br>
</div>

<pre><code><span id="TYPEinterval"><span class="keyword">type</span> <code class="type"></code>interval</span> = private </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTinterval.INone"><span class="constructor">INone</span></span></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Regular repetition of events.  <code class="code">span</code> is greater than zero.
      Note that this interval will be added to the wakeup time of
      the timer and hence not correspond to exact periods of time.
      This means that e.g. if the process is put to sleep, it will not
      experience repetitive calls for intermediate events.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTinterval.INormal"><span class="constructor">INormal</span></span> <span class="keyword">of</span> <code class="type"><a href="Span.html#TYPEt">Span.t</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Randomized repetition of events.  <code class="code">span</code> is greater than zero.
      The float specifies the maximum ratio with which <code class="code">span</code> will be
      multiplied and added to itself, and is in the range [0.0, 1.0].</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTinterval.IRandom"><span class="constructor">IRandom</span></span> <span class="keyword">of</span> <code class="type"><a href="Span.html#TYPEt">Span.t</a> * float</code></code></td>

</tr></table>

<div class="info">
Type of intervals for repeated events<br>
</div>

<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">?min_size:int -> unit -> <a href="Timer.html#TYPEt">t</a></code></pre><div class="info">
<code class="code">create ?min_size ()</code> creates a new timer.  The minimum size of the
    heap used by the timer is <code class="code">min_size</code>.<br>
<b>Returns</b> the timer.<br>
</div>
<div class="param_info"><code class="code">min_size</code> : default = 1000</div>
<pre><span id="VALsize"><span class="keyword">val</span> size</span> : <code class="type"><a href="Timer.html#TYPEt">t</a> -> int</code></pre><div class="info">
<code class="code">size timer</code> returns the number of events in a timer's heap. Repeating events only
    count once.<br>
</div>
<pre><span id="VALdeactivate"><span class="keyword">val</span> deactivate</span> : <code class="type"><a href="Timer.html#TYPEt">t</a> -> unit</code></pre><div class="info">
<code class="code">deactivate timer</code> deactives a timer.  No scheduled event
    will get executed after this function returns.<br>
</div>
<pre><span id="VALadd"><span class="keyword">val</span> add</span> : <code class="type"><a href="Timer.html#TYPEt">t</a> -><br>       (<a href="Timer.html#TYPEevent">event</a> -> <a href="Time.html#TYPEt">Time.t</a> -> unit) -><br>       ?randomize:float -> ?interval:<a href="Span.html#TYPEt">Span.t</a> -> <a href="Span.html#TYPEt">Span.t</a> -> <a href="Timer.html#TYPEevent">event</a></code></pre><div class="info">
<code class="code">add timer handler ?randomize ?interval span</code><br>
<b>Raises</b><ul><li><code>Failure</code> if timer is deactivated.</li>
<li><code>Invalid_argument</code> if <code class="code">interval</code> is a time span &lt;= 0.0.</li>
<li><code>Invalid_argument</code> if maximum random ratio not within [0.0, 1.0].</li>
</ul>
<b>Returns</b> a scheduled
    event.  <code class="code">handler</code> will be executed <code class="code">span</code> seconds at the earliest
    after this function returns in the timer's thread, and it gets
    its associated event as argument (useful for letting interval
    timers remove themselves) and the time at which the timer thread
    woke up.
<p>

    NOTE: the <code class="code">handler</code> must not allow any exceptions to escape.  <code class="code">span</code>
    must be greater than zero.  If the same handler is used in multiple
    timers, then the handler must be reentrant.  The handler must not
    block, and should return as quickly as possible, eventually passing
    off work to other threads if handling an event would take too long.
<p>

    An <code class="code">interval</code> can be specified to keep rescheduling the event.
    <code class="code">interval</code> can be randomized (e.g. for proteanism): the float
    specifies the maximum ratio with which <code class="code">interval</code> will be multiplied
    and added to itself, and must be in the range [0.0, 1.0].<br>
</div>
<div class="param_info"><code class="code">randomize</code> : default = none</div>
<div class="param_info"><code class="code">interval</code> : default = none</div>
<pre><span id="VALadd_abs"><span class="keyword">val</span> add_abs</span> : <code class="type"><a href="Timer.html#TYPEt">t</a> -><br>       (<a href="Timer.html#TYPEevent">event</a> -> <a href="Time.html#TYPEt">Time.t</a> -> unit) -><br>       ?randomize:float -> ?interval:<a href="Span.html#TYPEt">Span.t</a> -> <a href="Time.html#TYPEt">Time.t</a> -> <a href="Timer.html#TYPEevent">event</a></code></pre><div class="info">
<code class="code">add_abs timer handler ?randomize ?interval time</code> same as <a href="Timer.html#VALadd"><code class="code">Timer.add</code></a>, but
    takes an absolute time <code class="code">time</code> for scheduling the event rather than
    a span.  This prevents a time-induced race condition if there is
    a long time between the internal reading of the current time and
    the scheduling of the event, which would artificially delay event
    execution.  This function is also more efficient than <a href="Timer.html#VALadd"><code class="code">Timer.add</code></a>.<br>
</div>
<pre><span id="VALremove"><span class="keyword">val</span> remove</span> : <code class="type"><a href="Timer.html#TYPEevent">event</a> -> unit</code></pre><div class="info">
<code class="code">remove event</code> removes <code class="code">event</code> from its associated timer.
<p>

    NOTE: there is no guarantee that the event will not happen anymore
    if this function returns.  The timer thread may be about to start
    the callback, which leads to an inevitable race condition here.
    Users should be aware of this situation and make sure to handle
    it correctly.<br>
<b>Raises</b> <code>Failure</code> if timer is deactivated.<br>
</div>
<pre><span id="VALreschedule"><span class="keyword">val</span> reschedule</span> : <code class="type"><a href="Timer.html#TYPEevent">event</a> -> ?randomize:float -> ?interval:<a href="Span.html#TYPEt">Span.t</a> -> <a href="Span.html#TYPEt">Span.t</a> -> unit</code></pre><div class="info">
<code class="code">reschedule event ?randomize ?interval span</code> reschedules <code class="code">event</code>
    to start by time span <code class="code">span</code> later than originally scheduled, and
    change its interval behaviour as described for <a href="Timer.html#VALadd"><code class="code">Timer.add</code></a>.<br>
<b>Raises</b><ul><li><code>Failure</code> if timer is deactivated.</li>
<li><code>Invalid_argument</code> if <code class="code">interval</code> is a time span &lt;= 0.0.</li>
<li><code>Invalid_argument</code> if maximum random ratio not within [0.0, 1.0].</li>
<li><code>Failure</code> if <code class="code">event</code> was not already scheduled.</li>
</ul>
</div>
<pre><span id="VALget_timer"><span class="keyword">val</span> get_timer</span> : <code class="type"><a href="Timer.html#TYPEevent">event</a> -> <a href="Timer.html#TYPEt">t</a></code></pre><div class="info">
<code class="code">get_timer event</code><br>
<b>Returns</b> timer associated with <code class="code">event</code>.<br>
</div>
<pre><span id="VALget_event_time"><span class="keyword">val</span> get_event_time</span> : <code class="type"><a href="Timer.html#TYPEevent">event</a> -> <a href="Time.html#TYPEt">Time.t</a></code></pre><div class="info">
<code class="code">get_event_time event</code><br>
<b>Returns</b> the time at which <code class="code">event</code> is scheduled
    to be run.<br>
</div>
<pre><span id="VALget_event_interval"><span class="keyword">val</span> get_event_interval</span> : <code class="type"><a href="Timer.html#TYPEevent">event</a> -> <a href="Timer.html#TYPEinterval">interval</a></code></pre><div class="info">
<code class="code">get_event_interval event</code><br>
<b>Returns</b> event interval associated with
    <code class="code">event</code>.<br>
</div>
<pre><span id="VALis_activated"><span class="keyword">val</span> is_activated</span> : <code class="type"><a href="Timer.html#TYPEt">t</a> -> bool</code></pre><div class="info">
<code class="code">is_activated timer</code><br>
<b>Returns</b> <code class="code">true</code> iff timer is activated.<br>
</div>
</body></html>